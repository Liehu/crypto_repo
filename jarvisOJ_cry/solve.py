#!/usr/bin/env python
# -*- coding: utf-8 -*-
__Auther__ = 'M4x'

from Crypto.Cipher import AES
from libnum import invmod, n2s
from string import printable

n = 0x16232bef74274e2ba98ccad8fe2fde37253167d3c8178ab237897bb4c6a262007f731a2ee8000a6b619f04c38f07b6f1c3033fee631aa41c44b44d3e6fe8f6eaa1e2a6191e727c132d50366691a583275d64cf566a8ce13fc049286093d1ffe61947a52a3a56839e8576b1f46dd5173056b4c3cb095efb25dabbe2f2804ff0805edd2976250cd56c5fbec455de871bf858ce5516295f77abdd54f3490bc87a80cd2b40affeb17c546a678ed302b6c3040456b08d852197cbd16b18e661dec8223399aa84b7bc24924d66c7f441c4bc384273d9539ccdd14857369f74808f9e1a09365de78615255deaa57500995e9665fb50844c4e5263a88ca766baf478e4b3
p = 21923000442303241948246705611012961386363979222832337901830115771108225052790542561546354900492517346509948893293947815540269559324755853024885763755326105992764892874460672868563016877283767896041303942408074441847604729963248840196198891665799683983218515141219460296731802976608949188271950502151714616353
q = n / p
assert p * q == n
e = 0x10001
d = invmod(e, (p - 1) * (q - 1))
#  print "d -> 0x%x" % d
flag = 'd4YTd0Mzn00FZzqelVCB7IJ9e8xVLAmUPWZFbCO4ZzE='.decode("base64")

ck = 0xa2cd1e47b2b7dedd666d44a9eb3a2a68b1d10e3e70003aebc020ae48398f4f0276464f1bed5b1e63c0b02a19aef6f8f1f6348abb2c7c4ed2d4a05b1c721446bf146a115a700dcc57ee83002566a71b61e60df19929d2a39bff712f788a4eccdc75163c9005e7bdcd1aba68c6248f3df433d03ec3ce5328a98b555ab5fb626a171de3be38dae475e946a19c5c926b13b5fdd8723d67deb5b515fdef528f98da1816be8690f1fcda28adbbc2304291bc43938cc968b5cb50d8541a6c711aea0f2f5161ffbb8f0fc53429b1ed05909924310c4d836a7bbaff388087d25cc45482b645eec2c592e8d619b2a3e1062d132e74cee7c7c60db6c3c16b74194bf6ab119
civ = 0x11adff648f2a80f8dfba153f1d6867b51599f21ba30e6f9acff51269014b9d7a689979a9a3e44f7308d68280c10f23d73adcbded243861a03e53da50933b7fffdf7ec496e218d0879db94001ef7b934b6316e7b6c9055e23de2652d67bee207bb267cb3abac3d167501e9c253ee2385e3d29edcb5ec5deca3ed205e67a5e3bbeeb81e1f3c21181d5d866cbe8c8ebfd4a76c5ea14311a7b7168772f3badd172c5d583e4041682dd8eddae1a3093e87cab247cc2dee3ddcc9538607776bfb56f4bc21cee54416d03cdf74a3d74a73a2173fb35bb0e4325e33ae1f0d422a75537494099730cfbe7bb989e166bf1e07244fd3168cc04e6527d54538c9deafced69e1

aes_key = pow(ck, d, n)
print "aes_key -> 0x%x" % aes_key
iv = pow(civ, d, n)
print "iv -> 0x%x" % iv

cipher = AES.new(n2s(aes_key), AES.MODE_CBC, n2s(iv))
print cipher.decrypt(flag)
